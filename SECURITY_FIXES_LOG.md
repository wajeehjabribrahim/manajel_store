# ๐ ุณุฌู ุงูุฅุตูุงุญุงุช ุงูุฃูููุฉ

**ุงูุชุงุฑูุฎ:** 26 ูุจุฑุงูุฑ 2026  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ๐ด ุงููุดุงูู ุงูุญุฑุฌุฉ ุงูููุตูุญุฉ

### 1๏ธโฃ **ููุน ุชุนุฏูู ุงูุฃุณุนุงุฑ ูู ุงูุณูุฉ** โ ูุตุญุญ
**ุงูููู:** `src/app/api/orders/route.ts`

**ูุง ุชู:**
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ุงูุดุฑุงุก
- โ ุงูุชุญูู ูู ุงูุณุนุฑ ุงูุตุญูุญ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูููุงุฑูุฉ ูุน ุงูุณุนุฑ ุงูููุฑุณู (ุงูุณูุงุญ ุจู ยฑ0.01 ููุชูุฑูุจ)
- โ ุฑูุถ ุงูุทูุจ ุฅุฐุง ุงุฎุชูู ุงูุณุนุฑ
- โ ุงูุชุญูู ูู ุญุงูุฉ ุงูููุชุฌ (inStock)

**ุงูููุฏ:**
```typescript
const dbProduct = await prisma.product.findUnique({
  where: { id: String(item.id) },
  select: { id: true, name: true, price: true, sizes: true, inStock: true },
});

// ุงูุชุญูู ูู ุชุทุงุจู ุงูุณุนุฑ
if (Math.abs(price - correctPrice) > 0.01) {
  return NextResponse.json(
    { error: `ุณุนุฑ ุบูุฑ ูุชุทุงุจู ููููุชุฌ: ${dbProduct.name}` },
    { status: 400 }
  );
}
```

---

### 2๏ธโฃ **ุชุณุฑุจ ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ** โ ูุตุญุญ
**ุงูููู:** `src/app/api/orders/route.ts`

**ูุง ุชู:**
- โ ุนุฏู ุฅุฑุณุงู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูู ุงูุฅููููุงุช
- โ ุฅุฑุณุงู ููุท ุงููุนูููุงุช ุงูุถุฑูุฑูุฉ (ุงูุงุณู ูุงูุณุนุฑ ูุงูุญุฌู)
- โ ุฅุฒุงูุฉ ุงูุตูุฑ ูู ุงูุฅูููู
- โ ุฅุฒุงูุฉ ุชูุงุตูู ุงูุนููุงู ูุงููุงุชู ูู ุงูุฅูููู

**ุงูููุฏ:**
```typescript
await sendOrderNotification(email, {
  id: order.id,
  total,
  items: normalizedItems.map(item => ({
    id: item.productId,
    name: item.name,
    size: item.size,
    quantity: item.quantity,
    price: item.price
    // ูุง ุชุฑุณู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
  })),
  createdAt: order.createdAt,
});
```

---

### 3๏ธโฃ **ุดุฑุงุก ููุชุฌุงุช ูุญุฐููุฉ** โ ูุตุญุญ
**ุงูููู:** `src/app/api/orders/route.ts`

**ูุง ุชู:**
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌ ูุจู ุฅุถุงูุชู ููุทูุจ
- โ ุฑูุน ุงูููุชุฌ ุฅุฐุง ูุงู ูุญุฐููุงู
- โ ุงูุชุญูู ูู ุญุงูุฉ ุงููุฎุฒูู

**ุงูููุฏ:**
```typescript
const dbProduct = await prisma.product.findUnique({
  where: { id: String(item.id) }
});

if (!dbProduct) {
  return NextResponse.json(
    { error: `ุงูููุชุฌ ุบูุฑ ููุฌูุฏ: ${item.id}` },
    { status: 400 }
  );
}

if (!dbProduct.inStock) {
  return NextResponse.json(
    { error: `ุงูููุชุฌ ุบูุฑ ูุชููุฑ: ${dbProduct.name}` },
    { status: 400 }
  );
}
```

---

### 4๏ธโฃ **ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช** โ ูุตุญุญ
**ุงูููู:** `src/app/api/orders/route.ts`

**ูุง ุชู:**
- โ ุงูุชุญูู ูู ุตุญุฉ ุงููููุงุช (0-9999)
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุฃุณุนุงุฑ (0-999999)
- โ ุงูุชุญูู ูู ุตูุบุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ุงูุชุญูู ูู ุตูุบุฉ ุฑูู ุงููุงุชู
- โ ุฑุณุงุฆู ุฎุทุฃ ุจุงูุนุฑุจูุฉ

**ุงูููุฏ:**
```typescript
// ุงูุชุญูู ูู ุตุญุฉ ุงููููุฉ
if (!Number.isInteger(quantity) || quantity <= 0 || quantity > 9999) {
  return NextResponse.json(
    { error: `ูููุฉ ุบูุฑ ุตุญูุญุฉ ููููุชุฌ: ${item.name}` },
    { status: 400 }
  );
}

// ุงูุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
if (email && !email.includes("@")) {
  return NextResponse.json(
    { error: "ุจุฑูุฏ ุฅููุชุฑููู ุบูุฑ ุตุญูุญ" },
    { status: 400 }
  );
}

// ุงูุชุญูู ูู ุตูุบุฉ ุงููุงุชู
if (shippingPhone && !/^[0-9\-\+\s]{7,}$/.test(shippingPhone)) {
  return NextResponse.json(
    { error: "ุฑูู ูุงุชู ุบูุฑ ุตุญูุญ" },
    { status: 400 }
  );
}
```

---

## ๐ ูุดุงูู ูุชูุณุทุฉ ุงูููุตูุญุฉ

### 5๏ธโฃ **ูุนุงูุฌุฉ ุงูุตูุฑ ุงูููููุฏุฉ** โ ูุตุญุญ
**ุงูููู:** `src/app/cart/page.tsx`

**ูุง ุชู:**
- โ ุฅุถุงูุฉ fallback image ุนูู ุงูุตูุฑ ุงูููููุฏุฉ
- โ ูุนุงูุฌุฉ ุฎุทุฃ ุงูุชุญููู (onError)
- โ ุนุฑุถ ุฃููููุฉ ุจุฏู ุงูุตูุฑุฉ ุงููุงุฑุบุฉ

**ุงูููุฏ:**
```typescript
<img
  src={productImage}
  alt={productName}
  onError={(e) => {
    e.currentTarget.src = "/images/placeholder.png";
  }}
/>
```

---

### 6๏ธโฃ **ุญุฏ ุฃูุตู ููุตูุฑ ุงููุฑููุนุฉ** โ ูุตุญุญ
**ุงูููู:** `src/app/admin/products/[id]/edit/page.tsx`

**ูุง ุชู:**
- โ ุชุญุฏูุฏ ุงูุญุฏ ุงูุฃูุตู (5 ุตูุฑ)
- โ ุงูุชุญูู ูู ุนุฏุฏ ุงููููุงุช
- โ ุฑุณุงูุฉ ุฎุทุฃ ุฅุฐุง ุฒุงุฏุช ุนู ุงูุญุฏ

**ุงูููุฏ:**
```typescript
onChange={(e) => {
  const files = Array.from(e.target.files || []);
  if (files.length > 5) {
    setError("ุงูุญุฏ ุงูุฃูุตู 5 ุตูุฑ ุฅุถุงููุฉ");
    return;
  }
  setImageFiles(files);
}}
```

---

### 7๏ธโฃ **ุชุฃููุฏ ูุจู ุญุฐู ุงูุตูุฑ** โ ูุตุญุญ
**ุงูููู:** `src/app/admin/products/[id]/edit/page.tsx`

**ูุง ุชู:**
- โ ุฅุถุงูุฉ ุชุฃููุฏ ูุจู ุงูุญุฐู
- โ ุฑุณุงูุฉ ุชุฃููุฏ ุจุงูุนุฑุจูุฉ

**ุงูููุฏ:**
```typescript
onClick={() => {
  if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุตูุฑุฉุ")) {
    setExistingImages(existingImages.filter((_, i) => i !== idx));
  }
}}
```

---

### 8๏ธโฃ **ุญูุงูุฉ ุงูุตูุงุญูุงุช** โ ูุตุญุญ
**ุงููููุงุช:**
- `src/app/api/admin/orders-stats/route.ts`
- `src/app/api/admin/users-stats/route.ts`
- `src/app/api/admin/orders-yearly/route.ts`
- `src/app/admin/page.tsx`

**ูุง ุชู:**
- โ ุฏุงูุฉ `verifyAdmin()` ููุญุฏุฉ ููุชุญูู ูู ุงูุตูุงุญูุงุช
- โ ูุญุต ุญุงูุฉ ุงููุณุคูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ (401 ู 403)
- โ ุญูุงูุฉ ุตูุญุงุช ุงูุฅุฏุงุฑุฉ
- โ ุฅุนุงุฏุฉ ุชูุฌูู ุบูุฑ ุงููุตุฑุญูู

**ุงูููุฏ:**
```typescript
async function verifyAdmin(request: NextRequest) {
  const session = await getServerSession(authOptions);

  if (!session?.user) {
    return { error: "ุบูุฑ ูุตุฑุญ - ุชุณุฌูู ุงูุฏุฎูู ูุทููุจ", status: 401 };
  }

  const user = await prisma.user.findUnique({
    where: { id: (session.user as any).id },
    select: { id: true, role: true }
  });

  if (!user || user.role !== "admin") {
    return { error: "ุญู ุงููุตูู ูุฑููุถ - ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ูุทููุจุฉ", status: 403 };
  }

  return { success: true };
}
```

---

### 9๏ธโฃ **ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูุชููุงุฆู** โ ูุตุญุญ
**ุงูููู:** `src/app/admin/orders/page.tsx`

**ูุง ุชู:**
- โ ุชุญุฏูุซ ุงูุจูุงูุงุช ูู 30 ุซุงููุฉ
- โ ุชูุธูู ุงูู interval ุนูุฏ ุงูุฎุฑูุฌ
- โ ุจุฏูู ุชุฃุซูุฑ ุณูุจู ุนูู ุงูุฃุฏุงุก

**ุงูููุฏ:**
```typescript
useEffect(() => {
  loadOrders();
  
  // ุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู ูู 30 ุซุงููุฉ
  const interval = setInterval(() => {
    loadOrders();
  }, 30000);

  return () => clearInterval(interval);
}, []);
```

---

### ๐ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุงูุนุฑุจูุฉ** โ ูุตุญุญ
**ุงูููู:** `src/app/api/products/route.ts` (ู ูููุงุช API ุฃุฎุฑู)

**ูุง ุชู:**
- โ ุฌููุน ุฑุณุงุฆู ุงูุฎุทุฃ ุจุงูุนุฑุจูุฉ
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ
- โ ุฑููุฒ HTTP ุงูุตุญูุญุฉ (400, 401, 403, 500)

---

## ๐ก ูุดุงูู ุจุณูุทุฉ ุงูููุตูุญุฉ

### 11๏ธโฃ **ุชุญุณููุงุช ุงููุงุฌูุฉ** โ ูุตุญุญ
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
- โ ุญุงูุงุช ุงูุชุญููู
- โ ุชุฃููุฏุงุช ูุจู ุงูุนูููุงุช ุงูุญุณุงุณุฉ

---

## ๐ ููุฎุต ุงูุชุนุฏููุงุช

| ุงููุดููุฉ | ุงูููู | ุงูุญู | ุงูุญุงูุฉ |
|--------|------|------|--------|
| ุชุนุฏูู ุงูุฃุณุนุงุฑ | orders/route.ts | ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ |
| ุชุณุฑุจ ุงูุจูุงูุงุช | orders/route.ts | ุนุฏู ุฅุฑุณุงู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ | โ |
| ููุชุฌุงุช ูุญุฐููุฉ | orders/route.ts | ุงูุชุญูู ูู ุงููุฌูุฏ | โ |
| ุตูุฑ ููููุฏุฉ | cart/page.tsx | fallback + onError | โ |
| ุญุฏ ุฃูุตู ุตูุฑ | edit/page.tsx | ุชุญุฏูุฏ โค 5 | โ |
| ุชุฃููุฏ ุงูุญุฐู | edit/page.tsx | confirm() | โ |
| ุงูุตูุงุญูุงุช | ุฌููุน routes | verifyAdmin() | โ |
| ุชุญุฏูุซ ุฏููุงูููู | orders/page.tsx | interval 30s | โ |
| ุฃุฎุทุงุก ุนุฑุจูุฉ | ุฌููุน routes | ุฑุณุงุฆู AR | โ |

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงุฎุชุจุฑ ูู ุดูุก** ูุจู ุงููุดุฑ
2. **ุชุญูู ูู ุงูู console** ุจุญุซุงู ุนู ุฃุฎุทุงุก
3. **ุงุฎุชุจุฑ ุงูุณูุฉ** ูุน ุชุนุฏูู ุงูุฃุณุนุงุฑ
4. **ุงุฎุชุจุฑ ุงูุทูุจุงุช** ูุน ููุชุฌุงุช ูุญุฐููุฉ
5. **ุชุฃูุฏ ูู ุงูุตูุงุญูุงุช** ูููุณุคูููู ููุท

---

## โ ุงูุฎุทูุงุช ุงูุชุงููุฉ

- [ ] ุงุฎุชุจุงุฑ ุดุงูู ููู cart ูุงูุทูุจุงุช
- [ ] ุงุฎุชุจุงุฑ ุญูุงูุฉ ุงูุตูุงุญูุงุช
- [ ] ุงุฎุชุจุงุฑ ุงูุตูุฑ ุงูููููุฏุฉ
- [ ] ูุดุฑ ุงูุจูุงูุงุช ุงูุญูุฉ
- [ ] ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก

